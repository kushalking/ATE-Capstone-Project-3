pipeline {
    agent any
    
    tools {
        maven 'Maven 3.2.5'
        jdk 'Java 17'
    }
    
    stages {
         stage('Prepare WebDriver') {
            steps {
        // Kill existing Chrome processes
        sh 'pkill -f chrome'
        sh 'pkill -f chromedriver'
        
        // Create symbolic link
        sh 'sudo ln -s /usr/bin/google-chrome-stable /usr/bin/google-chrome'
    }
}
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Build') {
            steps {
                sh 'mvn clean compile'
            }
        }
        
        stage('UI Tests') {
            steps {
                sh 'mvn test -Dcucumber.filter.tags="@ui"'
            }
        }
        
        stage('API Tests') {
            steps {
                sh 'mvn test -Dtest=FlightReservationApiTest'
            }
        }
    }
    
  post {
    always {
        // Cucumber reporting
        cucumber failedFeaturesCount: -1, 
                failedScenariosCount: -1, 
                failedStepsCount: -1, 
                skippedStepsCount: -1, 
                successfulStepsCount: -1, 
                reportTitle: 'Cucumber Reports',
                fileIncludePattern: '**/cucumber.json',
                jsonReportDirectory: 'target'
        
        // Publish TestNG reports
        junit '**/surefire-reports/*.xml'
    }
}
}
