pipeline {
    agent any
    
    tools {
        maven 'Maven 3.2.5'
        jdk 'Java 17'
    }
    
    stages {
         stage('Prepare WebDriver') {
            steps {
        // Kill existing Chrome processes
            sh     '''
                        pkill -f chrome || true
                        pkill -f chromedriver || true
                    '''
    }
}
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Build') {
            steps {
                sh 'mvn clean compile'
            }
        }
        
        stage('UI Tests') {
            steps {
                sh 'mvn test -Dcucumber.filter.tags="@ui"'
            }
        }
        
        stage('API Tests') {
            steps {
                sh 'mvn test -Dtest=FlightReservationApiTest'
            }
        }
    }
    
post {
    always {
        cucumber failedFeaturesNumber: -1, 
                failedScenariosNumber: -1, 
                failedStepsNumber: -1, 
                skippedStepsNumber: -1, 
                classifications: [
                    [key: 'cucumber', value: 'PASSED']
                ],
                reportTitle: 'Cucumber Reports',
                fileIncludePattern: '**/CucumberTestReport.json',
                jsonReportDirectory: 'target/cucumber-reports'
        
        // Publish TestNG reports
        junit '**/surefire-reports/*.xml'
    }
}
}
